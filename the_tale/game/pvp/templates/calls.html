{% extends "pvp/base.html" %}

{% block title %}Вызовы на арену | {{ super() }}{% endblock %}

{% block head %}
{{ super() }}

<script src="{{ STATIC_URL }}game/widgets.js" type="text/javascript"></script>
<script src="{{ STATIC_URL }}game/data/abilities.js" type="text/javascript"></script>

<script type="text/javascript">
var updater = undefined;
var abilities = undefined;

jQuery(document).ready(function(e){

    updater = new pgf.game.Updater({url: "{{ url('game:info', account=resource.account.id) }}"});

    setTimeout(function RefreshData() {
        if (updater) {
            updater.Refresh();
        }
    }, 0);

    abilities = new pgf.game.widgets.Abilities();
});
</script>

{% endblock %}

{% block content %}

<div class="block white">

<h2>Арена</h2>

<p>
  На этой странице можно найти информацию о героях, ищущих спарринг-партнёра для поединка на арене.
</p>

{% if not resource.account.is_authenticated() %}
<p class="pgf-unlogined-message">
  <strong>Вам необходимо <a href="{{login_url(resource.request.get_full_path())}}">войти</a> или <a href="{{ url('accounts:registration:fast') }}" class="pgf-fast-registration attention-link">создать героя</a>, чтобы принимать участие в PvP.</strong>
</p>
{% else %}
{% if resource.can_participate %}
<p class="pgf-level-restrictions-message">
  <strong>Вы можете принять вызов любого героя при условии, что его уровень не меньше {{ACCEPTED_LEVEL_MIN}} и не больше {{ACCEPTED_LEVEL_MAX}}.</strong>
</p>
{% else %}
<p class="pgf-fast-account-message">
  <strong>Сейчас Вы не можете принимать участие в PvP, возможно, вы не завершили регистрацию.</strong>
</p>
{% endif %}
{% endif %}

<h3>Вызовы</h3>

{% if battles %}
<table class="table table-striped table-condensed table-no-highlighting">
  {% for battle in battles %}
  <tr>
    <td>
      {% set hero = heroes[battle.account_id] %}

      <a href="{{ url('game:heroes:show', hero.id) }}">{{hero.name}}</a> уровень {{hero.level}}

      {% if own_hero is not none and  own_hero.id != hero.id %}
        {% if ACCEPTED_LEVEL_MIN <= hero.level <= ACCEPTED_LEVEL_MAX %}
        <a href="#"
           data-battle-id="{{battle.id}}"
           data-redirect-on-success="{{url('game:pvp:')}}"
           class="pgf-accept-battle angel-ability pgf-ability-arenapvp1x1accept">
          <i class="icon-tint" rel="tooltip" title="недостаточно энергии"></i>
          <i class="icon-ban-circle" rel="tooltip" title="необходимо завершить регистрацию"></i>
          принять вызов
        </a>
        {% else %}
        <i class="pgf-can-not-accept-call">вы не можете принять вызов</i>
        {% endif %}
      {% else %}
      <strong class="pgf-own-battle-message">ваш вызов</strong>
      {% endif %}
    </td>
  </tr>
  {% endfor %}
</table>
{% else %}
<p class="pgf-no-calls-message">
  Сейчас ни один герой не ищет боя.
</p>
{% endif %}

</div>


{% endblock %}
