{% extends "bills/base.html" %}

{% import 'macros.html' as base_macros with context %}
{% import 'bills/macros.html' as bills_macros with context %}
{% import 'forum/thread_page.html' as thread_page with context %}

{% block title %} {{ bill.caption }} | {{ super() }}{% endblock %}


{% block bills_content %}

<div class="bills-page-title">
  {{ base_macros.addthis(title="Закон «%s»" % bill.caption, description=bill.rationale_html|safe) }}
  <h2 style="display: inline-block;">{{ bill.caption }}</h2>
</div>

{{ bills_macros.bill_info(bill) }}

{% if bill.state._is_VOTING %}

{% if resource.account == bill.owner %}
<a class="" style="margin-bottom: 1em; display: inline-block;" href="{{ url('game:bills:edit', bill.id) }}">редактировать</a>
{% endif %}

{% if resource.can_moderate_bill(bill) %}
<a class="" style="margin-bottom: 1em; display: inline-block;" href="{{ url('game:bills:moderate', bill.id) }}">администрировать</a>
{% endif %}

{% endif %}

{% if vote is not none %}

<div class="test-already-voted-block">

  {% if vote.type._is_FOR %}
  <h3 class="alert alert-success pgf-voted-for-message">Вы поддержали закон</h3>
  {% elif vote.type._is_AGAINST %}
  <h3 class="alert alert-error pgf-voted-against-message">Вы выступили против закона</h3>
  {% else %}
  <h3 class="alert alert-info pgf-voted-refrained-message">Вы воздержались от голосования</h3>
  {% endif %}
</div>

{% elif not resource.can_participate_in_politics %}

<p class="alert alert-info pgf-can-not-participate-in-politics">
  Предлагать законы и голосовать могут только подписчики, оформить подписку можно на странице <a href="{{url('accounts:payments:shop')}}">магазина</a>.
</p>

{% else %}

{% if bill.state._is_VOTING %}
<div class="well pgf-voting-block">
  <h3>Идёт голосование</h3>

  <ul>
    <li>Вы не сможете изменить своё решение, будьте аккуратны в выборе!</li>
    <li>Отдав свой голос, пригласите своих друзей сделать то же самое.</li>
    <li>Помните, закон будет принят только если количество проголосовавших «за» превысит как процентный барьер, так и количественный.</li>
  </ul>

  голосовать
  <a class="btn btn-success pgf-forms-post-simple" href="{{ url('game:bills:vote', bill.id) }}?type={{VOTE_TYPE.FOR.value}}">«за»</a>
  <a class="btn btn-danger pgf-forms-post-simple" href="{{ url('game:bills:vote', bill.id) }}?type={{VOTE_TYPE.AGAINST.value}}">«против»</a>
  <a class="btn btn-info pgf-forms-post-simple" href="{{ url('game:bills:vote', bill.id) }}?type={{VOTE_TYPE.REFRAINED.value}}">«воздержаться»</a>

</div>
{% endif %}

{% endif %}

<h3 style="margin-bottom: 0.5em;">{{ bill.data.CAPTION }}</h3>

{% include bill.data.SHOW_TEMPLATE with context %}

<h3>Обоснование</h3>

<p>
  {{ bill.rationale_html|safe }}
</p>

{{ thread_page.thread_page(thread_data) }}

{% endblock %}
