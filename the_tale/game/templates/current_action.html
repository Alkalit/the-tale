
{% macro current_action(show_abilities=true, data_mode='pve', say_form=none) %}
<script type="text/javascript">
jQuery(document).ready(function(e) {

    widgets.actions = new pgf.game.widgets.Action('#current-action-block',
                                                   updater, widgets,
                                                   {dataMode: "{{data_mode}}" } );

    {% if show_abilities %}
    widgets.abilities = new pgf.game.widgets.Abilities('#abilities-block',
                                                       widgets,
                                                       {tooltipTemplate: '#pgf-ability-tooltip-template'});
    {% endif %}

    {% if say_form %}
    var sayForm = new pgf.forms.Form(jQuery('#pgf-say-form'),
                                     {OnSuccess: function(instance, data){jQuery("#id_text").val("");
                                                                          updater.Refresh();}});
    {% endif %}

});
</script>

<div id="current-action-block" class="block" style="cursor: default;">

  <strong class="action-info pgf-action-info"></strong>

  <div class="progress progress-success" style="margin: 10px 0;">
    <div class="bar pgf-action-percents"></div>
  </div>

  {% if show_abilities %}
  <div id="abilities-block">

    <a href="#" class="pgf-ability-help pgf-hidden">
      <i class="icon-tint" rel="tooltip" title="недостаточно энергии"></i>
      <i class="icon-ban-circle" rel="tooltip" title="необходимо завершить регистрацию"></i>
      помочь
    </a>

    <span style="width: 5em; display: inline-block;"></span>

    <a href="#" class="pgf-ability-arenapvp1x1 pgf-hidden">
      <i class="icon-tint" rel="tooltip" title="недостаточно энергии"></i>
      <i class="icon-ban-circle" rel="tooltip" title="необходимо завершить регистрацию"></i>
      на арену
    </a>

    <span class="pgf-in-pvp-queue-message pgf-hidden" rel="tooltip" title="идёт поиск противника для битвы на арене">в очереди…</span>

  </div>
  {% endif %}

  {% if say_form %}
  <form id="pgf-say-form" method="post" class="form-inline" action="{{ url('game:pvp:say') }}" style="margin: 0;">

    {{ say_form.errors_container }}

    <table width="100%">
      <tr>
        <td style="padding-right: 1em;">
          <input id="id_text" type="text" name="text" maxlength="{{say_form.text.field.max_length}}" style="margin: 0; width: 100%;"/>
        </td>
        <td width="5em;">
          <input type="submit" value="Сказать" class="btn pull-right"/>
        </td>
      </tr>
    </table>

  {% endif %}

</div>

{% endmacro %}
