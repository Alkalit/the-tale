{% extends "base.html" %}

{% import 'heroes/macros.html' as macros with context %}

{% block head %}
{{ super() }}

<script src="{{ STATIC_URL }}game/widgets.js" type="text/javascript"></script>
<script src="{{ STATIC_URL }}game/angel.js" type="text/javascript"></script>

<script type="text/javascript">

var updater = undefined;
var angelUpdater
var widgets = {};

jQuery(document).ready(function(e){

    updater = new pgf.game.Updater({url: "{{ url('game:info') }}?angel={{ resource.angel.id }}"});
    angelUpdater = new pgf.game.AngelUpdater({url: "{{ url('game:angels:info', resource.angel.id) }}"});

    setTimeout(function(){
        updater.Refresh();
        angelUpdater.Refresh();
    }, 0);

    jQuery('.pgf-choose-ability-button').click(function(){
        pgf.ui.dialog.Create({ fromUrl: pgf.urls['game:heroes:choose_ability_dialog']({{ resource.hero.id }}),
                               OnOpen: function(dialog) {
                                   pgf.tooltips.Refresh('.pgf-chose-hero-ability-dialog');

                                   jQuery('.pgf-ability-record', dialog).click(function(e){
                                       e.preventDefault();
                                       
                                       var el = jQuery(e.currentTarget);

                                       pgf.forms.Post({ action: pgf.urls['game:heroes:choose_ability']({{ resource.hero.id }}, el.data('ability-id')),
                                                        OnSuccess: function(data) { location.reload(); }
                                                      });
                                       
                                   });
                               },
                               OnClose: function(dialog) {
                                   pgf.tooltips.Hide('.pgf-chose-hero-ability-dialog');
                               }
                             });
    });
});

</script>

{% endblock %}

{% block content %}

<div id="hero-page-content">

  <div id="left-column" class="column">
    {% include "heroes/hero_short.html" %}
    {% include "heroes/hero_equipment.html" %}
  </div>

  <div id="center-column" class="column">

    {% if resource.hero.destiny_points %}
    <div id="choose-ability-button" class="block pgf-choose-ability-button">
      <h2>ВЫБEРИТЕ НОВУЮ СПОСОБНОСТЬ</h2>
    </div>
    {% endif %}

    <div class="block">
      <h2>Боевые способности</h2>
      {% set abilities = resource.hero.get_abilities() %}
      {{ macros.abilities_list(abilities) }}
    </div>
  </div>

  <div id="right-column" class="column">
    <div class="block">
      <h2>Статистика</h2>
    </div>
  </div>

</div>

{% include "heroes/item_tooltip.html" %}

{% endblock %}
