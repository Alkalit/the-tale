<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
  <head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
    <link href="{{ url('news:feed') }}" type="application/atom+xml" rel="alternate" title="Новости" />
    <title>{% block title%}{% endblock %}</title>

    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-10915391-4']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>

    <link rel="stylesheet" type="text/css" href="{{ LESS_CSS_URL }}main.css" />
    <link rel="stylesheet" type="text/css" href="{{ LESS_CSS_URL }}javascript.css" />

    <script src="{{ STATIC_URL }}plugins/jquery/jquery-1.7.2.min.js" type="text/javascript"></script>
    <script src="{{ STATIC_URL }}plugins/jquery/jquery-ui-1.8.9/js/jquery-ui-1.8.9.custom.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="{{ STATIC_URL }}plugins/jquery/jquery.url.js" type="text/javascript"></script>

    <script src="{{ STATIC_URL }}plugins/spin/spin.min.js" type="text/javascript"></script>
    <script src="{{ STATIC_URL }}plugins/jquery/jquery.spin.js" type="text/javascript"></script>

    <link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}bootstrap/css/bootstrap.min.css" />
    <script src="{{ STATIC_URL }}bootstrap/js/bootstrap.min.js" type="text/javascript"></script>

    <!-- <script src="{{ STATIC_URL }}plugins/jquery/tipsy/jquery.tipsy.js" type="text/javascript" charset="utf-8"></script> -->
    <!-- <link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}plugins/jquery/tipsy/tipsy.css" /> -->

    <script src="{{ STATIC_URL }}plugins/globalize/globalize.js"></script>
    <script src="{{ STATIC_URL }}plugins/globalize/cultures/globalize.culture.ru.js"></script>

    <script src="{{ STATIC_URL }}common/base.js" type="text/javascript"></script>
    <script src="{{ STATIC_URL }}common/dialog.js" type="text/javascript"></script>
    <script src="{{ STATIC_URL }}common/forms.js" type="text/javascript"></script>
    <!-- <script src="{{ STATIC_URL }}common/tooltips.js" type="text/javascript"></script> -->
    <script src="{{ STATIC_URL }}common/urls.js" type="text/javascript"></script>
    <!-- <script src="{{ STATIC_URL }}common/dialog.js" type="text/javascript"></script> -->

    {% if settings.DEBUG %}
    <script src="{{ STATIC_URL }}common/debug.js" type="text/javascript"></script>
    {% endif %}

    <script type="text/javascript">

STATIC_URL = "{{ STATIC_URL }}"

jQuery(document).ready(function() {

    Globalize.culture('ru');
    pgf.base.AutoFormatTime();

    jQuery.ajaxSetup({
        beforeSend: function(xhr, settings) {

            function getCookie(name) {
                var cookieValue = null;
                if (document.cookie && document.cookie != '') {
                    var cookies = document.cookie.split(';');
                    for (var i = 0; i < cookies.length; i++) {
                        var cookie = jQuery.trim(cookies[i]);
                        if (cookie.substring(0, name.length + 1) == (name + '=')) {
                            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                            break;
                        }
                    }
                }
                return cookieValue;
            }
            if (!(/^http:.*/.test(settings.url) || /^https:.*/.test(settings.url))) {
                xhr.setRequestHeader("X-CSRFToken", getCookie('csrftoken') );
            }
        }
    });

    // pgf.tooltips.Init();

    jQuery('.pgf-fast-registration').click(function(e){
        e.preventDefault();
        pgf.forms.Post({ OnSuccess: function(data)
                         {
                             location.href = "{{ url('accounts:introduction') }}";
                         },
                         action: jQuery(e.currentTarget).attr('href')
                       });
    });

    $('[rel="tooltip"]').tooltip({animation: true,
                                  placement: 'left',
                                  delay: { show: 500,
                                           hidr: 100 } })
});
    </script>

    {% block head %}{% endblock%}
  </head>
  <body>

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">

          <a class="brand" href="{{ url('portal:') }}">Сказка</a>

          <ul class="nav">
            <li><a href="{{ url('portal:') }}">Главная</a></li>
            <li><a href="{{ url('news:') }}">Новости</a></li>
            <li><a href="{{ url('forum:') }}">Форум</a></li>
            <li><a href="{{ url('game:') }}">Игра</a></li>
            {% if resource.account %}
            <li class="divider-vertical"></li>
            <li><a href="{{ url('accounts:profile') }}">Профиль игрока</a></li>
            <li><a href="{{ url('game:heroes:show', resource.account.angel.get_hero().id) }}">Страница героя</a></li>
            {% endif %}
          </ul>

          <ul class="nav pull-right">
            <li>
              {% set game_time = resource.time.game_time %}
              <p id="time-block" class="navbar-text">
                <span class="pgf-game-date">{{ game_time.verbose_date}}</span>
                <span class="pgf-game-time">{{ game_time.verbose_time }}</span>
              </p>
            </li>
            <li class="divider-vertical"></li>
            {% if request.user.is_authenticated() %}
            <li><a href="{{ url('accounts:logout') }}">выйти</a></li>
            {% else %}
            <li><a href="{{ url('accounts:fast-registration') }}" class="pgf-fast-registration"><strong>играть без регистрации</strong></a></li>
            <li><a href="{{ url('accounts:login') }}">войти</a></li>
            {% endif %}
          </ul>

        </div>
      </div>
    </div>

    {% block body %}

    {% if settings.DEBUG %}
    <ul style="position: absolute; right: 0; top: 60px;">
      {% block debug_menu%}
      {% endblock %}
    </ul>
    {% endif %}

    <div id="main-container">
      <div id="content" class="container">

        {% if resource.account and resource.account.is_fast %}
        <div class="alert alert-info">
          ВНИМАНИЕ! Ваша игра доступна только с этого компьютера. Для игры из друго места необходимо задать email и пароль в своём <a href="{{ url('accounts:profile') }}">профиле</a> (подробнее о быстрой регистрации можно почитать в <a href="{{ url('portal:manual') }}">Путеводителе по Сказке</a>).
        </div>
        {% endif %}

        {% block content %}
        {% endblock %}
      </div>
    </div>

    <footer role="contentinfo" class="container">
      <div class="row">
        <div class="span12">
          <ul class="unstyled">
            <li>© 2011-{{now().year}} Елецкий Алексей</li>
            <li>использована часть иконок из набора <a href="http://glyphicons.com" target="_blank">Glyphicons</a></li>
            <li>использована часть иконок из  <a href="http://eu.battle.net/wow/en/" target="_blank">WoW</a>, будут убраны как только нарисуются альтернативные, близы не обижайтесь :-)</li>
            <li>использованы картинки из различных источников, будут убраны как только нарисуются альтернативные, если вы автор какой-либо из картинок, сообщите нам об этом. В зависимости от Вашего желания, мы либо оставим ссылку на Ваш ресурс либо уберём картинку</li>
          </ul>
        </div>
      </div>
    </footer>

    {% endblock %}
  </body>
</html>
