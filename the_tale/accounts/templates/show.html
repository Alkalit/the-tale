{% extends "accounts/base.html" %}

{% import 'accounts/macros.html' as accounts_macros with context %}

{% block title %} {{ master_account.nick_verbose }} | {{ super() }}{% endblock %}
{% block description %}О Хранителе «{{ master_account.nick_verbose }}» и «{{ master_hero.name }}» — герое {{ master_hero.level }} уровня.{% endblock %}

{% block head %}
{{ super() }}

<script type="text/javascript">

jQuery(document).ready(function(){

{% if resource.account.is_authenticated() and master_account.id != resource.account.id%}

    {{  accounts_macros.personal_message_js() }}

{% if friendship is none %}

    jQuery('.pgf-friends-request-friendship').click(function(e){
        e.preventDefault();
        pgf.ui.dialog.Create({ fromUrl: "{{ url('accounts:friends:request', friend=master_account.id) }}",
                               OnOpen: function(dialog) {
                                   var friendshipForm = new pgf.forms.Form(jQuery('.pgf-friendship-request', dialog),
                                                                           { OnSuccess: function(form, data){ location.reload(); }
                                                                           });
                               }
                             });
    });

{% endif %}

{% endif %}

});

</script>
{% endblock %}


{% block content %}

  <div class="row">
    <div class="span3">
      <div class="block">
        <h3 class="game-navigation-caption" style="padding-left: 2px;">Страница игрока</h3>
        <ul class="game-navigation nav nav-list" style="padding-left: 2px;">

          <li class="nav-element">
            <small>
              был в игре <span class="pgf-format-date" data-timestamp="{{ master_account.was_in_game_at|timestamp}}"></span>
            </small>
          </li>

          {% if resource.account.is_authenticated() and master_account.id != resource.account.id %}

            <li class="nav-element "><a class="pgf-new-message" data-recipient="{{master_account.id}}" href="#">личное сообщение</a></li>

            {% if friendship is none %}
              <li class="nav-element "><a class="pgf-friends-request-friendship" href="#">добавить в друзья</a></li>
            {% elif friendship.is_confirmed %}
              <li class="nav-element"><span class="pgf-friends-in-list">в списке друзей</span></li>
            {% elif friendship.friend_1_id == master_account.id %}
              <li class="nav-element ">
                <span class="pgf-friends-request-from">
                  игрок предлагает дружить
                  <a class="pgf-forms-post-simple" href="{{url('accounts:friends:accept', friend=master_account.id)}}">принять</a> /
                  <a class="pgf-forms-post-simple" href="{{url('accounts:friends:remove', friend=master_account.id)}}">отказать</a>
                </span>
              </li>
            {% else %}
              <li class="nav-element"><span class="pgf-friends-request-to">вы предложили дружбу</span></li>
            {% endif %}

            <li class="nav-element "><a href="{{forum_complaint_theme()}}">пожаловаться</a></li>

         {% endif %}

         {% set can_invite_to_guild = resource.account.is_authenticated() and master_account.id != resource.account.id and own_clan_info and master_clan_info.membership is none and own_clan_info.can_invite %}

         <li class="nav-header">Гильдия</li>
         <li class="nav-element">
          {% if master_clan_info.membership is not none %}
            <a href="{{url('accounts:clans:show', master_clan_info.clan.id)}}">[{{master_clan_info.clan.abbr}}] {{master_clan_info.clan.name}}</a>
          {% elif can_invite_to_guild %}
              <script type="text/javascript">
    jQuery(document).ready(function(){
        jQuery('.pgf-create-invite-to-clan').click(function(e){
            e.preventDefault();
            pgf.ui.dialog.Create({ fromUrl: "{{ url('accounts:clans:membership:invite', account=master_account.id) }}",
                                   OnOpen: function(dialog) {
                                       var newMessageForm = new pgf.forms.Form(jQuery('#pgf-invite-form', dialog),
                                                                               { OnSuccess: function(form, data){ dialog.modal('hide'); }
                                                                               });
                                   }
                                 });
                });
                });
              </script>

              <a class="pgf-create-invite-to-clan" href="#">пригласить</a>

          {% else %}
            Не состоит в гильдии
          {% endif %}
         </li>

         <li class="nav-header">Мир</li>
         <li class="nav-element"><a href="{{ url('game:bills:') }}?owner={{master_account.id}}">законопроекты  ({{bills_count}})</a></li>
         <li class="nav-element"><a href="{{ url('game:phrase-candidates:') }}?author_id={{master_account.id}}">фразы ({{phrases_count}})</a></li>
         <li class="nav-element"><a href="{{ url('blogs:posts:') }}?author_id={{master_account.id}}">произведения ({{folclor_posts_count}})</a></li>

         <li class="nav-header">Форум</li>
         <li class="nav-element"><a href="{{url('forum:threads:')}}?author={{master_account.id}}">созданые обсуждения ({{threads_count}})</a></li>
         <li class="nav-element"><a href="{{url('forum:threads:')}}?participant={{master_account.id}}">обсуждения с комментариями ({{threads_with_posts}})</a></li>

         {% if resource.can_moderate_accounts %}
           <li class="divider"></li>
           <li class="nav-element">
             <a class="pgf-account-admin-link" href="{{url('accounts:admin', master_account.id)}}">администрировать</a>
           </li>
         {% endif %}


        </ul>
      </div>
    </div>

    <div class="span9">
      <div class="block white">

        <h2 style="line-height: 24px;">
          <small>
            Хранитель
          </small>
          {{ master_account.nick_verbose }}

          <small>
            и
            <a href="{{ url('game:heroes:show', master_hero.id) }}">{{ master_hero.name }}</a>
            —
            {{ master_hero.gender_verbose }}-{{ master_hero.race_verbose }}
            {{ master_hero.level }} уровня
          </small>
        </h2>

        {% if master_account.is_ban_forum %}
          <p class="alert alert-error pgf-ban-forum-message">
            Игроку запрещено общаться на форуме до <span class="pgf-format-datetime" data-timestamp="{{ master_account.ban_forum_end_at|timestamp }}"></span>
          </p>
        {% endif %}

        {% if master_account.is_ban_game %}
          <p class="alert alert-error pgf-ban-game-message">
            Герой игрока не оказывает влияние на мир до <span class="pgf-format-datetime" data-timestamp="{{ master_account.ban_game_end_at|timestamp }}"></span>
          </p>
        {% endif %}

        <br/>

        <table width="100%" style="text-align: center;">
          <tbody>
            <tr>
              <td width="25%" style="vertical-align: middle;">
                МОГУЩЕСТВО<br/>
                <span style="font-size: 20pt;">{{ master_account.might|int }}</span></br>
                <a href="{{url('guide:keepers')}}">путеводитель</a>
              </td>
              <td width="25%" style="vertical-align: middle;">
                ОЧКИ ДОСТИЖЕНИЙ<br/>
                <span style="font-size: 20pt;">{{master_achievements.points}}</span></br>
                <a href="{{url('accounts:achievements:', account=master_account.id)}}">все достижения</a>
              </td>
              <td width="25%" style="vertical-align: middle;">
                ПРЕДМЕТОВ В КОЛЛЕКЦИИ<br/>
                <span style="font-size: 20pt;">{{master_items.get_items_count()}}</span></br>
                <a href="{{url('collections:collections:', account=master_account.id)}}">коллекция</a>
              </td>
              <td width="25%" style="vertical-align: middle;">
                ПОСЛЕДОВАТЕЛИ<br/>
                <span style="font-size: 20pt;">{{ master_account.referrals_number }}</span></br>
                <a href="{{url('guide:referrals')}}">реферальная ссылка</a>
              </td>
            </tr>
          </tbody>
        </table>

        <br/>

        <div class="row-fluid">
          <div class="span6">

            <h3>Рейтинги</h3>

            <p>Положение игрока в рейтингах.</p>

            {% if rating_values %}

              <table class="table table-condensed table-striped table-bordered table-no-highlighting">
                <tbody>
                  <tr>
                    <th >название</th>
                    <th width="100px">место</th>
                  </tr>

                  <tr><td>могущество</td><td> {% if rating_values.might > 0 %}{{ rating_places.might_place }} место{% else %}не участвует{% endif %}</td></tr>
                  <tr><td>принятые законы</td><td> {% if rating_values.bills_count > 0 %}{{ rating_places.bills_count_place }} место{% else %}не участвует{% endif %}</td></tr>
                  <tr><td>сила героя</td><td> {{ rating_places.power_place }} место</td></tr>
                  <tr><td>уровень героя</td><td> {{ rating_places.level_place }} место</td></tr>
                  <tr><td>добавленные фразы</td><td> {% if rating_values.phrases_count > 0 %}{{ rating_places.phrases_count_place }} место{% else %}не участвует{% endif %}</td></tr>
                  <tr><td>сражений PvP</td><td> {% if rating_values.pvp_battles_1x1_number > 0 %}{{ rating_places.pvp_battles_1x1_number_place }} место{% else %}не участвует{% endif %}</td></tr>
                  <tr><td>побед PvP</td><td> {% if rating_values.pvp_battles_1x1_victories > 0 %}{{ rating_places.pvp_battles_1x1_victories_place }} место{% else %}не участвует{% endif %}</td></tr>
                  <tr><td>очки достижений</td><td> {% if rating_values.achievements_points > 0 %}{{ rating_places.achievements_points_place }} место{% else %}не участвует{% endif %}</td></tr>
                  <tr><td>последователи</td><td> {% if rating_values.referrals_number > 0 %}{{ rating_places.referrals_number_place }} место{% else %}не участвует{% endif %}</td></tr>
                </tbody>
              </table>
            {% else %}
              <p class="alert alert-info">Игрок пока не участвует в рейтингах</p>
            {% endif %}

          </div>

          <div class="span6">
            <h3>Политика</h3>

            <p>Города, которым герой помогает чаще.</p>

            {% if most_common_places %}
              <div class="pgf-scrollable" style="overflow-y: auto; max-height: {{1+27*(1+bills_settings.PLACES__TO_ACCESS_VOTING)}}px;">

                <table class="table table-condensed table-striped table-bordered table-no-highlighting">
                  <tbody>
                    <tr>
                      <th width="30px">№</th>
                      <th >город</th>
                      <th width="100px">помогал (раз)</th>
                    </tr>
                    {% for place, number in most_common_places %}
                      <tr>
                        <td>{{loop.index}}</td>
                        <td>{{place.name}}</td>
                        <td>{{number}}</td>
                      </tr>
                    {% endfor %}
                  </tbody>
                </table>

              </div>

          {% else %}

            <p class="alert alert-info pgf-no-common-places-message">
              Герой ещё не помог ни одному городу.
            </p>
          {% endif %}

          </div>

        </div>


        {% if accounts_settings.INFORMER_SHOW and master_account.id == resource.account.id %}
          <h3>Информер</h3>
          <p>
            Нашим игроком <a target="_blank" href="{{url('accounts:show', accounts_settings.INFORMER_CREATOR_ID)}}">{{accounts_settings.INFORMER_CREATOR_NAME}}</a> был разработан информер, для вставки в подписи на форумах и аналогичных им местах. За что ему большое спасибо.
          </p>

          <div style="margin: 1em; text-align: center;">
            <img width="{{accounts_settings.INFORMER_WIDTH}}px" height="{{accounts_settings.INFORMER_HEIGHT}}px" src="{{informer_link}}"></img>
          </div>

          <div class="accordion" id="pgf-informer-accordion">

            <div class="accordion-group">
              <div class="accordion-heading">
                <div class="accordion-toggle collapsed" data-toggle="collapse" data-parent="#pgf-informer-accordion" href="#pgf-informer-codes">
                  <a href="#">
                    Наиболее распространённые коды для вставки информера.
                  </a>
                </div>
              </div>
              <div id="pgf-informer-codes" class="accordion-body collapse" style="height: 0px;">
                <div class="accordion-inner">
                  <ul class="unstyled">
                    <li style="margin: 0.5em;">
                      ссылка на картинку:<br/>
                      <code>{{informer_link}}</code>
                    </li>
                    <li style="margin: 0.5em;">
                      bb-код:<br/>
                      <code style="display: block;">
                        [url={{full_url('http', 'accounts:show', master_account.id, **{accounts_settings.REFERRAL_URL_ARGUMENT: master_account.id} )}}]<br/>
                        [img]{{informer_link}}[/img]<br/>
                        [/url]
                      </code>
                    </li>
                    <li style="margin: 0.5em;">
                      html-код:<br/>
                      <code style="display: block;">
                        &lt;a href="{{full_url('http', 'accounts:show', master_account.id, **{accounts_settings.REFERRAL_URL_ARGUMENT: master_account.id})}}"&gt;<br/>
                        &lt;img width="{{accounts_settings.INFORMER_WIDTH}}px" height="{{accounts_settings.INFORMER_HEIGHT}}px" src="{{informer_link}}"&gt;&lt;/src&gt;<br/>
                        &lt;/a&gt;
                      </code>
                    </li>
                  </ul>

                </div>
              </div>
            </div>

          </div>

          <p>
            Обращаем ваше внимание, что информер является сторонним продуктом и администрация игры не несёт ответственности за его функционирование.
          </p>

          <p>
            Обсудить работу информера можно на нашем <a href="{{url('forum:threads:show', accounts_settings.INFORMER_FORUM_THREAD)}}">форуме</a>.
          </p>

        {% endif %}

    </div>
  </div>
</div>



{% endblock %}
