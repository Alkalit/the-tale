{% extends "accounts/base.html" %}

{% import 'accounts/macros.html' as accounts_macros with context %}

{% block title %}Платежи | {{ super() }}{% endblock %}

{% block head %}
{{ super() }}
<script type="text/javascript">
jQuery(document).ready( function(e) {

    jQuery('.pgf-pay-dialog-link').click(function(e){
        e.preventDefault();
        var target = jQuery(e.currentTarget);
        var url = target.attr('href');
        pgf.ui.dialog.Create({ fromUrl: url,
                               OnOpen: function(dialog) {
                                   var payForm = new pgf.forms.Form(jQuery('#pgf-dengionline-pay-form', dialog),
                                                                    {OnSuccess: function(instance, data){location.href = data.data.next_url;}});
                                   var realAmountField = jQuery('#id_real_amount', dialog);
                                   var gameAmountField = jQuery('#id_game_amount', dialog);
                                   realAmountField.on('change keyup', function(e){
                                       var realValue = parseInt(realAmountField.val());
                                       var realAmount = (realValue == realAmountField.val() ? realValue : 0) * {{resource.usd_to_premium}};
                                       gameAmountField.val(isNaN(realAmount) ? 0 : realAmount);
                                   });
                               }
                             });
    });


});

</script>

{% endblock %}

{% block accounts_content %}

<h2>Платежи</h2>

<table class="table table-condensed table-striped table-bordered table-no-highlighting">
  <tbody>
    <tr>
      <th width="200px">тип аккаунта</th>
      <td>
        {{ accounts_macros.account_type_label(resource.account) }} &nbsp; <a href="{{url('guide:account-types')}}">[типы аккаунтов]</a>
      </td>
    </tr>

    <tr>
      <th>окончание подписки</th>
      <td>
        {% if account.is_premium %}
        <span class="updated-at pgf-format-datetime" data-timestamp="{{ account.premium_end_at|timestamp }}"></spann>
        {% else %}
        —
        {% endif %}
      </td>
    </tr>

    <tr>
      <th>количество печенек</th>
      <td>
        <span style="vertical-align: middle;">{{ account.bank_account.amount }}</span>
        {% if resource.dengionline_enabled %}
        <a style="vertical-align: middle;" href="{{url('accounts:payments:pay-dialog')}}" class="pgf-pay-dialog-link btn btn-mini btn-success">купить</a>
        {% endif %}
      </td>
    </tr>
  </tbody>
</table>

<ul class="nav nav-pills">
  <li {% if page_type == 'shop' %}class="active"{% endif %}><a href="{{ url('accounts:payments:shop') }}">Магазин</a></li>
  <li {% if page_type == 'history' %}class="active"{% endif %}><a href="{{ url('accounts:payments:history') }}">История</a></li>
</ul>


{% block payments_content %}
{% endblock %}

{% endblock %}
