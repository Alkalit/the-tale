{% extends "forum/base.html" %}

{% block title %}{{subcategory.caption}} | {{ super() }}{% endblock %}

{% macro pages_links(thread) %}

{% set pages_count = thread.paginator.pages_count %}

{% if pages_count == 1 %}
{% elif pages_count < 7 %}
<span class="thread-page-links">
[{% for page_number in range(1, pages_count) %}
  <a href="{{ url('forum:threads:show', thread.id) }}?page={{page_number+1}}">{{page_number+1}}</a>
{% endfor %}]
{% else %}
[  <a href="{{ url('forum:threads:show', thread.id) }}?page=2">2</a>
  <a href="{{ url('forum:threads:show', thread.id) }}?page=3">3</a>
  <a href="{{ url('forum:threads:show', thread.id) }}?page=4">4</a>
  &hellip;
{% for page_number in range(pages_count-3, pages_count) %}
  <a href="{{ url('forum:threads:show', thread.id) }}?page={{page_number+1}}">{{page_number+1}}</a>
{% endfor %}]
{% endif %}
</span>
{% endmacro %}

{% block forum_content %}

<ul class="breadcrumb">
  <li><a href="{{ url('forum:') }}">Форум</a><span class="divider">/</span></li>
  <li class="active">{{ subcategory.caption }}</li>
</ul>

<table class="table table-striped forum-table">
  <thead>
    <tr>
      <th class="caption">название</th>
      <th class="author">автор</th>
      <th class="posts-count">ответов</th>
      <th class="last-poster">последний</th>
      <th class="updated-at">обновлено</th>
    </tr>
  </thead>
  <tbody>
    {% for thread in threads %}
    <tr>
      <td class="caption">
        <a href="{{ url('forum:threads:show', thread.id) }}">{{ thread.caption }}</a>
        {{ pages_links(thread) }}
      </td>
      <td class="author">{{ thread.author.username }}</td>
      <td class="posts-count">{{ thread.posts_count }}</td>
      <td class="last-poster">{% if thread.last_poster %}{{ thread.last_poster.username }}{% else %} {{ thread.author.username }} {% endif %}</td>
      <td class="updated-at pgf-format-time" data-timestamp="{{ thread.updated_at|timestamp }}"></td>
    </tr>
    {% endfor %}
  </tbody>
</table>

{% if can_create_thread %}
<form action="{{ url('forum:threads:new')}}" method="get">
  <input type="hidden" name="subcategory_id" value="{{subcategory.id}}" />
  <input type="submit" value="Добавить обсуждение" class="pgf-new-thread-button"/>
</form>
{% endif %}

{% endblock %}
