{% extends "forum/base.html" %}

{% import 'macros.html' as base_macros with context %}
{% import 'forum/macros.html' as forum_macros with context %}

{% macro forum_paginator_line() %}
  <div class="pagination pull-left">
    <ul>
      {% if can_subscribe %}
      <li>
        {% if not has_subscription %}
        <a href="{{ url('forum:subscriptions:subscribe') }}?subcategory={{subcategory.id}}" class="pgf-forms-post-simple">подписаться</a>
        {% else %}
        <a href="{{ url('forum:subscriptions:unsubscribe') }}?subcategory={{subcategory.id}}" class="pgf-forms-post-simple">отписаться</a>
        {% endif %}
      </li>
      {% endif %}

      {% if resource.account.is_authenticated() %}
      <li>
        <a href="{{ url('forum:read-all', subcategory.slug) }}" class="pgf-forms-post-simple">«прочитать» всё</a>
      </li>
      {% endif %}
    </ul>
  </div>

  {{ base_macros.render_paginator(paginator) }}

{% endmacro %}


{% block title %}{{subcategory.caption}} | {{ super() }}{% endblock %}

{% block forum_content %}

<ul class="breadcrumb">
  <li>
    <a href="{{ url('forum:feed') }}" class="rss-link" rel="alternate" type="application/rss+xml" rel="tooltip" title="подписаться на rss форума">
      <img src="{{STATIC_URL}}images/rss.png" style="margin: 2px;"/>
    </a>
    <a href="{{ url('forum:') }}">Форум</a><span class="divider">/</span></li>
  <li class="active">{{ subcategory.caption }}</li>
</ul>

{{ forum_paginator_line() }}

<table class="table table-striped forum-table table-no-highlighting">
  <thead>
    <tr>
      {{ forum_macros.thread_record_heading() }}
    </tr>
  </thead>
  <tbody>
    {% for thread in threads %}
    <tr>
      {{ forum_macros.thread_record(thread, read_state) }}
    </tr>
    {% endfor %}
  </tbody>
</table>

{{ forum_paginator_line() }}

{% if can_create_thread %}
<form action="{{ url('forum:threads:new')}}" method="get">
  <input type="hidden" name="subcategory" value="{{subcategory.slug}}" />
  <input type="submit" value="Добавить обсуждение" class="btn pgf-new-thread-button"/>
</form>
{% endif %}

{% endblock %}
